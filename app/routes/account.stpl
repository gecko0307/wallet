% from app.utils import money, transactionAmount, toFixed, currencySymbol, currencyStep, datetimeFromStr, category, currentDateTime
% from app.utils import month as monthStr
<html lang="ru">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
        <meta name="Description" content="Wallet app"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="shortcut icon" href="favicon.gif" type="image/x-icon"/>
        <title>Wallet - {{ data.account.name }}</title>
        <link rel="stylesheet" href="style.css" Type="text/css"/>
    </head>
    <body>
        <div class="header">
            <p><a href="/">‚Üê –ö —Å–ø–∏—Å–∫—É —Å—á–µ—Ç–æ–≤</a><p>
        </div>
        <div class="content">
        
        <div class="properties">
            <h1> {{ data.account.name }} </h1>
            
            % if len(data.account.description) > 0:
                <h2>{{ data.account.description }}</h2>
            % end
            
            <h3>
                {{ money(data.account.balance, data.account.currency) }}
                % if data.account.currency != 'RUB':
                    <span style="color:#bbbbbb">({{ money(data.account.balance * data.account.exchangeRate, 'RUB') }})</span>
                % end
            </h3>
            
            % if data.account.currency != 'RUB':
                <p>–ö–æ–Ω–≤–µ—Ä—Å–∏—è –ø–æ –∫—É—Ä—Å—É: <b>{{ toFixed(data.account.exchangeRate, 2) }}</b></p>
            % end
        </div>
        
        <a href="/editAccount?id={{data.account.id}}">–ò–∑–º–µ–Ω–∏—Ç—å —Å—á–µ—Ç</a> | <a href="/confirmDeleteAccount?id={{data.account.id}}">–£–¥–∞–ª–∏—Ç—å —Å—á–µ—Ç</a>
        
        <p><b>–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:</b></p>
        
        <table class="transactions-table">
            <colgroup>
                <col style="width:10%;"/>
                <col style="width:22%;"/>
                <col style="width:33%;"/>
                <col style="width:15%;"/>
                <col style="width:20%;"/>
            </colgroup>
            
            <tr>
                <th>–î–∞—Ç–∞</th> 
                <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th> 
                <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                <th>–°—É–º–º–∞</th>
                <th></th>
            </tr>
            
            % transactions = data.account.transactions
            % for year, months in sorted(transactions.items()):
                % dataShown = int(year == str(currentDateTime().year))
                <tr>
                    <th colspan="5">
                        <a href="#" id="hider-{{ year }}" class="row-hider" data-shown="{{ dataShown }}" onclick="event.preventDefault(); toggleYear('{{ year }}');">
                            <span id="arrow-{{ year }}" class="row-hider-arrow">{{ "‚ñº" if dataShown else "‚ñ∫" }}</span> {{ year }}</a>
                    </th> 
                </tr>
                % for monthi, month in enumerate(months):
                    % if len(month) > 0:
                        <tr class="group-{{ year }}" style="display: {{ "table-row" if dataShown else "none" }}">
                            <th colspan="5">
                                <b>{{ monthStr(monthi).capitalize() }} ({{ len(month) }}):</b>
                                <!--
                                <a href="#" id="hider-{{ year }}-{{ monthi }}" class="row-hider" data-shown="true" onclick="event.preventDefault(); toggleMonth('{{ year }}', '{{ monthi }}');">
                                    <span id="arrow-{{ year }}-{{ monthi }}" class="row-hider-arrow">‚ñº</span> {{ monthStr(monthi) }}</a>
                                -->
                            </th> 
                        </tr>
                    % end
                    % for transaction in sorted(month, key = lambda x: datetimeFromStr(x.date)):
                        <tr id="transaction-{{ transaction.id }}" class="clickablerow group-{{ year }} group-{{ year }}-{{ monthi }}" style="display: {{ "table-row" if dataShown else "none" }}">
                            <th>{{ datetimeFromStr(transaction.date).strftime('%d.%m.%Y') }}</th> 
                            <th><a href="/transactionsByCategory?cat={{transaction.category}}">{{ category(transaction.category) }}</a></th> 
                            <th>{{ transaction.description }}</th>
                            <th style="color:{{ "#379683" if transaction.value > 0 else "#e24444" }}"><b>{{ transactionAmount(transaction.value, transaction.currency) }}</b></th>
                            <th>
                                <span class="hiddenlink">
                                    <a class="hiddenlink" href="/editTransaction?id={{transaction.id}}">–ò–∑–º–µ–Ω–∏—Ç—å</a> | 
                                    <a class="hiddenlink" href="/deleteTransaction?id={{transaction.id}}">–£–¥–∞–ª–∏—Ç—å</a>
                                </span>
                            </th>
                        </tr>
                    % end
                % end
            % end
        </table>
        
            <form id="NewTransactionForm" method="post" action="/newTransaction?account={{data.account.id}}" accept-charset="utf-8">
                <p style="margin-bottom:0"><b>–°–æ–∑–¥–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é:</b></p>
                <table class="new-transcation-table">
                    <colgroup>
                        <col style="width:14%;"/>
                        <col style="width:20%;"/>
                        <col style="width:29%;"/>
                        <col style="width:17%;"/>
                        <col style="width:20%;"/>
                    </colgroup>
                    <tr>
                        <th><input type="date" id="NewTransactionInputDate" name="date" title="–î–∞—Ç–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏" required></th>
                        <th><div class="selectdiv"><select id="NewTransactionInputCategory" name="category" size="1" title="–ö–∞—Ç–µ–≥–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏">
                            <option value="unspecified" selected>‚ùì [–ù–µ –≤—ã–±—Ä–∞–Ω–æ]</option>
                            <option value="notrack">‚ùî [–í–Ω–µ –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç–∏]</option>
                            <option value="charity">üéóÔ∏è –ë–ª–∞–≥–æ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</option>
                            <option value="household">üõÄ –ë—ã—Ç–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã</option>
                            <option value="lodging">üè† –ñ–∏–ª—å–µ</option>
                            <option value="books">üìö –ö–Ω–∏–≥–∏</option>
                            <option value="music">üéµ –ú—É–∑—ã–∫–∞</option>
                            <option value="culture">üé≠ –ö—É–ª—å—Ç—É—Ä–Ω—ã–π –¥–æ—Å—É–≥</option>
                            <option value="catering">üçî –û–±—â–µ–ø–∏—Ç</option>
                            <option value="clothes">üëî –û–¥–µ–∂–¥–∞</option>
                            <option value="cosmetics">üíÑ –ö–æ—Å–º–µ—Ç–∏–∫–∞</option>
                            <option value="gifts">üéÅ –ü–æ–¥–∞—Ä–∫–∏</option>
                            <option value="food">üçè –ü—Ä–æ–¥—É–∫—Ç—ã –ø–∏—Ç–∞–Ω–∏—è</option>
                            <option value="meds">üíä –õ–µ–∫–∞—Ä—Å—Ç–≤–∞</option>
                            <option value="communication">üì± –°–≤—è–∑—å</option>
                            <option value="software">üéÆ –°–æ—Ñ—Ç, –∏–≥—Ä—ã</option>
                            <option value="tech">üíª –¢–µ—Ö–Ω–∏–∫–∞</option>
                            <option value="transport">üöó –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</option>
                            <option value="hobby">üé® –•–æ–±–±–∏ –∏ —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ</option>
                            <option value="salary">üíº –ó–∞—Ä–ø–ª–∞—Ç–∞</option>
                            <option value="fee">üí≤ –ì–æ–Ω–æ—Ä–∞—Ä</option>
                            <option value="ecommerce">üí∞ –≠-–∫–æ–º–º–µ—Ä—Ü–∏—è –∏ —Ñ—Ä–∏–ª–∞–Ω—Å</option>
                            <option value="crowdfunding">üíñ –ö—Ä–∞—É–¥—Ñ–∞–Ω–¥–∏–Ω–≥</option>
                            <option value="interest">üíµ –ü—Ä–æ—Ü–µ–Ω—Ç—ã –æ—Ç –±–∞–Ω–∫–æ–≤</option>
                            <option value="trading">üìà –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏</option>
                            <option value="find">üí≤ –ù–∞—Ö–æ–¥–∫–∞</option>
                            <option value="art">üñº –ü—Ä–æ–¥–∞–∂–∞ –∫–∞—Ä—Ç–∏–Ω</option>
                            <option value="tax">‚öñÔ∏è –ù–∞–ª–æ–≥–∏</option>
                            <option value="other">‚ùì –ü—Ä–æ—á–µ–µ</option>
                            </select>
                        </div></th>
                        <th><input id="NewTransactionInputDescription" name="description" type="text" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏"></th> 
                        <th><input id="NewTransactionInputValue" name="value" type="number" min="0.00" step="{{currencyStep(data.account.currency)}}" value="0.00" title="–°—É–º–º–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏" required> {{ currencySymbol(data.account.currency) }}</th>
                        <th>
                            <input id="NewTransactionButtonSubmit" type="submit" formaction="/newTransaction?account={{data.account.id}}&type=add" value="+" title="–ù–∞—á–∏—Å–ª–∏—Ç—å —Å—É–º–º—É"> 
                            <input id="NewTransactionButtonSubmit" type="submit" formaction="/newTransaction?account={{data.account.id}}&type=sub" value="‚àí" title="–°–ø–∏—Å–∞—Ç—å —Å—É–º–º—É">
                        </th>
                    </tr>
                </table>
            </form>
        
        <script>
            document.getElementById("NewTransactionInputDate").valueAsDate = new Date();
            
            function toggleHider(hiderId, arrowId)
            {
                var triangleShown = "‚ñº";
                var triangleHidden = "‚ñ∫";
                var hider = document.getElementById(hiderId);
                var arrow = document.getElementById(arrowId);
                var shown = hider.getAttribute("data-shown");
                if (shown == "1")
                {
                    arrow.innerText = triangleHidden;
                    hider.setAttribute("data-shown", "0");
                }
                else
                {
                    arrow.innerText = triangleShown;
                    hider.setAttribute("data-shown", "1");
                }
            }
            
            function toggleYear(year)
            {
                toggleHider("hider-" + year, "arrow-" + year);
                toggleRowsByClass("group-" + year);
            }
            
            function toggleMonth(year, month)
            {
                console.log(year, month);
                // TODO
            }
            
            function toggleRowsByClass(className)
            {
                console.log(className);
                var e = document.getElementsByClassName(className);
                for(var i = 0; i < e.length; i++)
                {
                    if (e[i].style.display == "none")
                        e[i].style.display = "table-row";
                    else
                        e[i].style.display = "none";
                }
            }
        </script>
        
        </div>
    </body>
</html>
